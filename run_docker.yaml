- hosts: all
  vars_files:
    - vars.yaml
  remote_user: "{{ssh_user}}"
  tasks:
  - name: Check if Telegraf is installed
    command: dpkg-query -W telegraf
    register: my_package_check_deb
    failed_when: my_package_check_deb.rc > 1
    changed_when: my_package_check_deb.rc == 1
  - name: copy Docker Compose files
    copy:
      src: docker-compose-files/{{ item }}
      dest: "/home/{{ssh_user}}/docker-compose/{{ item }}"
    loop:
    - docker-compose.yml
    - docker-compose.prod.yml
  # use files parameter to use multiple docker-compose.yml files
  - name: deploy Docker Compose stack
    docker_compose:
      project_src: "/home/{{ssh_user}}/docker-compose/"
      files:
      - docker-compose.yml
      - docker-compose.prod.yml